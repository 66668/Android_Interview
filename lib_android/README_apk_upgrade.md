# android app更新 总结

## 对于应用更新这块是如何做的?(灰度发布，强制更新，分区域更新)

1. 通过接口获取线上版本号，versionCode 
2. 比较线上的versionCode 和本地的versionCode，弹出更新窗口 
3. 下载APK文件(文件下载)
4. 安装APK

**灰度发布**:灰度发布是指在黑与白之间，能够平滑过渡的一种发布方式

方案一.服务端控制

许针对部分用户推送升级通知甚至版本强制升级。

无论哪种方法都需要做好版本管理工作，分配特别的版本号以示区别。

当然，既然是做灰度，数据监控（常规数据、新特性数据、主要业务数据）还是要做到位，该打的数据桩要打。

还有，灰度版最好有收回的能力，一般就是强制升级下一个正式版。

方案二.客服端+服务端控制（AB test方式）

客户端在打包的时候，将A功能B功能都打进同一个版本的Apk包里，然后在代码层写控制显示逻辑。后台接口控制当前版本显示APK上的A/B版本的分布，可以做到指定一部分用户使用A功能，一部分用户使用B功能。

服务器端应该有相应的报表来显示A/B版本的数量和使用效果对比，根据实时数据体现，再由服务器端接口控制用户全部切换到A版本或者B版本。

1. 找单一渠道投放特别版本。 （方案一）
2. 做升级平台的改造，允许针对部分用户推送升级通知甚至版本强制升级。(方案一)
3. 开放单独的下载入口。 (方案一)
4. AB test方式：(方案二)

两个版本的代码都打到app包里，然后在app端植入测试框架，用来控制显示哪个版本。测试框架 负责与服务器端api通信，由服务器端控制app上A/B版本的分布，
可以实现指定的一组用户看到A版 本，其它用户看到B版本。服务端会有相应的报表来显示A/B版本的数量和效果对比。最后可以由服务端 的后台来控制，全部用户在线切换到A或者B版本~



强制更新:一般的处理就是进入应用就弹窗通知用户有版本更新，弹窗可以没有取消按钮并不能取消。这 样用户就只能选择更新或者关闭应用了，当然也可以添加取消按钮，但是如果用户选择取消则直接退出应用。

增量更新:bsdiff:二进制差分工具bsdiff是相应的补丁合成工具,根据两个不同版本的二进制文件，**生成补丁文件.patch文件**。
通过bspatch使旧的apk文件与不定文件合成新的apk。 注意通过apk文件的 md5值进行区分版本。
